# Load Balancing
## 학습목표
1. 로드밸런싱(Load Balancing)이란?
2. 로드밸런싱 알고리즘





<br/>

## 1. 로드밸런싱(Load Balancing)이란?
로드밸런싱이란 네트워크 또는 서버에 가해지는 부하(Load)를 분산(Balancing)해주는 기술을 의미한다. **로드밸런싱 기술을 제공하는 장치(=로드 밸런서, Load Balancer)** 는 클라이언트와 서버들 또는 네트워크 허브 사이에 위치하게 된다.

특정 서버 또는 네트워크 허브에 부하가 집중되지 않도록 트래픽을 다양한 방법으로 분산시켜 최적의 상태로 유지할수 있도록 하는 기술이다.

서비스의 초기 단계에서는 적은 수의 클라이언트로 인해 한 대의 서버로만 서비스 운용이 가능하겠지만, 사업이 점점 확장하게 된다면 한 대의 서버로는 운용이 힘들 것 이다. 이 상황에서 늘어난 트래픽에 대해서 대처할 수 있는 방안은 Scale-up, Scale-out이 있다.

Scale-up은 서버 자체의 성능을 높이는 경우를 말하고, Scale-out은 성능이 동일하거나, 낮은 서버를 여러대 증설하여 운용하는 것을 말한다. 이 경우에 **로드밸런싱(Load Balancing)** 기술이 반드시 필요하다.

<br/>
<br/>

## 2. 로드밸런싱 알고리즘
### **1) L4로드밸런싱**
L4로드밸런서는 L4계층에서 동작하는 로드밸런서이므로 네트워크 계층이나 트랜스포트 계층의 정보를 바탕으로 로드를 분산한다. 사용자의 IP나 MAC주소 등에 따라 트래픽을 나누고 분산처리하는 것이 가능하다는 의미이다.

<br/>

### **2) L4로드밸런싱 알고리즘**
#### - 라운드로빈 방식 (Round Robin Method)
서버에 들어온 요청을 순서대로 분배하는 방식이다. 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 가지고 있고, 서버와의 연결이 오래 지속되지 않는 경우 활용하기 적합하다. 

#### - 가중 라운드로빈 방식 (Weighted Round Robin Method)
서버마다 비율을 설정해놓은 다음 해당 비율에 맞춰서 부하를 분배하는 방식이다. 예를들어 A라는 서버가 B서버에 비해 성능이 좋아서 7:3의 비율로 요청이 들어오도록 설정을 해놓는 방식이다.
    
#### - IP 해시방식 (IP Hash Method)
요청이 들어오는 IP를 대역별로 분리하여 서버에 요청을 분산하는 방식이다. 예를들어 10.10.10.* 대역의 IP를 사용하는 사용자는 1번서버로, 10.10.20.* 대역의 IP를 사용하는 사용자는 2번서버로 요청 보낸다.

#### - 최소 연결 방식 (Least Connection Method)
요청이 들어온 시점에 가장 적은 세션을 가진 서버에 우선적으로 트래픽을 배분하는 방식이다. 자주 세션이 길어지거나, 서버에 분배된 트래픽이 일정하지 않은 경우에 적합하다. 

#### - 최소 리스폰 타임 방식 (Least Response Time Method)
서버의 현재 연결상태와 응답시간을 모두 고려하여 트래픽을 배분하는 방식이다. 가장 적은 세션을 가진 서버와 가장짧은 응답시간을 보내는 서버에 우선적으로 트래픽을 배분한다.

<br/>
<br/>

### **3) L7로드밸런싱**
L7로드밸런서는 위의 L4로드밸런싱 알고리즘을 포함해서 OSI 7계층(ex HTTP, SMTP, FTP 등..)을 바탕으로도 분산처리가 가능하다. L7로드밸런서의 경우 애플리케이션 계층에서 로드를 분산하기 때문에 HTTP헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 트래픽 분산이 가능하다.

L4가 단지 부하를 분산하는 것이라면, L7은 요청의 세부적인 사항을 두고 결제만 담당하는 서버와 회원가입 만을 담당하는 서버 등으로 분리해서 가볍고 작은 단위로 여러개의 서비스를 운영하고 요청을 각각의 서버에 분산할 수 있는 것이다.

<br/>
<br/>

 ||L4 로드밸런서|L7 로드밸런서|
|------|---|---|
|계층|전송계층 (Transport Layer)|응용계층 (Application Layer)|
|특징|IP 또는 Mac주소 등의 정보로 분배|L4의 특징을 가지면서 HTTP, 쿠키 등의 정보도 가능|
|장점|1. 패킷 레벨에서만 로드를 분산하기 때문에 속도가 빠르다.<br/>2. L7 로드밸런서보다 가격이 저렴하다.|1. 상위 계층에서 로드를 분산하기 떄문에 섬세한 라우팅이 가능하다.<br/>2. 비정상적인 트래픽을 사전에 차단할 수 있기때문에 안정성이 높다.|
|단점|1. 사용자의 IP가 수시로 바뀌는 경우라면 연속적인 서비스를 제공하기 어렵다.<br/>2. 패킷의 내용을 살펴볼 수 없기 때문에 섬세한 라우팅이 불가능하다.|1. 패킷의 내용을 복호화 하기 떄문에 비용이 높다.<br/>2. 처리 시간이 오래걸린다.|


<br/>
<br/>
<br/>

## _References_
- https://m.post.naver.com/viewer/postView.nhn?volumeNo=27046347&memberNo=2521903
- https://www.stevenjlee.net/2020/06/30/%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%EC%9D%98-%EB%B6%80%ED%95%98%EB%B6%84%EC%82%B0-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-load-balancing-%EA%B7%B8/